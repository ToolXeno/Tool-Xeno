<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Merger & Splitter - Professional Tool</title>
    <meta name="description" content="Advanced PDF merge/split tool with page range selection, bookmark preservation, and batch processing">

    <!-- ✅ Tool Xeno Favicons -->
<link rel="icon" type="image/svg+xml" href="toolxeno-logo.svg">
<link rel="alternate icon" type="image/png" href="toolxeno-logo.png">
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon" href="toolxeno-logo.png">
<meta name="theme-color" content="#667eea">

    <!-- External Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- PDF-lib for PDF manipulation -->
    <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --accent-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --success-gradient: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            --warning-gradient: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            
            --dark-bg: #0a0a0a;
            --dark-surface: #1a1a1a;
            --dark-surface-elevated: #252525;
            --dark-text: #ffffff;
            --dark-text-secondary: #a0a0a0;
            --dark-border: #333333;
            
            --light-bg: #f8fafc;
            --light-surface: #ffffff;
            --light-surface-elevated: #f1f5f9;
            --light-text: #1e293b;
            --light-text-secondary: #64748b;
            --light-border: #e2e8f0;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            transition: background-color 0.35s cubic-bezier(0.4, 0, 0.2, 1), color 0.35s cubic-bezier(0.4, 0, 0.2, 1);
            line-height: 1.6;
            background-color: var(--dark-bg);
            color: var(--dark-text);
            min-height: 100vh;
        }
        
        body.light-theme { 
            background-color: var(--light-bg); 
            color: var(--light-text); 
        }

        .particles-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }
        
        .particle {
            position: absolute;
            border-radius: 50%;
            animation: float 20s infinite linear;
            opacity: 0.05;
            background: radial-gradient(circle, #667eea 0%, transparent 70%);
        }
        
        body.light-theme .particle { 
            background: radial-gradient(circle, #4facfe 0%, transparent 70%); 
        }
        
        @keyframes float { 
            0% { transform: translateY(100vh) rotate(0deg); } 
            100% { transform: translateY(-100px) rotate(360deg); } 
        }
        
        .header-glass {
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            background: rgba(0, 0, 0, 0.4);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        body.light-theme .header-glass { 
            background: rgba(255, 255, 255, 0.9); 
            border-bottom-color: rgba(0, 0, 0, 0.1); 
        }
        
        .theme-toggle {
            position: relative;
            width: 60px;
            height: 30px;
            background: var(--dark-surface);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .theme-toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 22px;
            height: 22px;
            background: var(--primary-gradient);
            border-radius: 50%;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        body.light-theme .theme-toggle { 
            background: var(--light-surface-elevated); 
            border-color: var(--light-border); 
        }
        
        body.light-theme .theme-toggle::after { 
            transform: translateX(28px); 
            background: var(--secondary-gradient); 
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        }
        
        body.light-theme .glass-card { 
            background-color: rgba(255, 255, 255, 0.9); 
            border-color: rgba(0, 0, 0, 0.1); 
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); 
        }
        
        .btn-gradient {
            background: var(--primary-gradient);
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 120px;
        }
        
        .btn-gradient:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4); 
        }
        
        .btn-gradient:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: var(--secondary-gradient);
            box-shadow: 0 4px 15px rgba(240, 147, 251, 0.3);
        }
        
        .btn-success {
            background: var(--success-gradient);
            box-shadow: 0 4px 15px rgba(17, 153, 142, 0.3);
        }
        
        .btn-warning {
            background: var(--warning-gradient);
            box-shadow: 0 4px 15px rgba(255, 154, 158, 0.3);
        }
        
        .drop-zone {
            border: 3px dashed rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 40px 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.02);
        }
        
        .drop-zone.drag-over {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            transform: scale(1.02);
        }
        
        body.light-theme .drop-zone {
            border-color: rgba(0, 0, 0, 0.2);
            background: rgba(0, 0, 0, 0.02);
        }
        
        .file-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 16px;
            margin: 8px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }
        
        .file-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(4px);
        }
        
        body.light-theme .file-item {
            background: rgba(0, 0, 0, 0.05);
            border-color: rgba(0, 0, 0, 0.1);
        }
        
        body.light-theme .file-item:hover {
            background: rgba(0, 0, 0, 0.1);
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 16px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--success-gradient);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }
        
        .tab-button {
            padding: 12px 24px;
            background: transparent;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: inherit;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .tab-button.active {
            background: var(--primary-gradient);
            border-color: transparent;
            color: white;
        }
        
        .tab-button:not(.active):hover {
            border-color: rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.05);
        }
        
        .pdf-preview {
            max-width: 200px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .pdf-preview:hover {
            transform: scale(1.05);
        }
        
        .page-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 16px 0;
        }
        
        .page-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .page-checkbox:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .page-checkbox input[type="checkbox"] {
            accent-color: #667eea;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 12px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            backdrop-filter: blur(20px);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success { background: var(--success-gradient); }
        .notification.error { background: var(--secondary-gradient); }
        .notification.info { background: var(--accent-gradient); }
        
        @media (max-width: 768px) {
            .container { padding: 0 16px; }
            .btn-gradient { padding: 10px 20px; font-size: 14px; }
            .drop-zone { padding: 30px 15px; }
        }
    </style>
</head>

<body>
    <!-- Floating Particles -->
    <div class="particles-container" id="particles"></div>
    
    <!-- Header -->
    <header class="header-glass fixed w-full top-0 z-50">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="text-3xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
                        🛠️ Tool Xeno
                    </div>
                    <div class="hidden md:block text-sm opacity-70">
                        PDF Merger & Splitter
                    </div>
                </div>
                <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" aria-label="Toggle theme"></button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="pt-24 pb-16 min-h-screen">
        <div class="container mx-auto px-6 max-w-6xl">
            
            <!-- Hero Section -->
            <div class="text-center mb-12">
                <h1 class="text-4xl md:text-6xl font-bold mb-6 bg-gradient-to-r from-purple-400 via-pink-400 to-blue-400 bg-clip-text text-transparent">
                    PDF Merger & Splitter
                </h1>
                <p class="text-xl opacity-80 max-w-3xl mx-auto mb-8">
                    Professional PDF merge and split tool with advanced features. Combine multiple PDFs or split them into individual pages with precision and control.
                </p>
                
                <!-- Feature Highlights -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 max-w-4xl mx-auto mb-8">
                    <div class="glass-card p-4">
                        <i class="fas fa-object-group text-2xl mb-2 text-purple-400"></i>
                        <p class="text-sm font-medium">Smart Merging</p>
                    </div>
                    <div class="glass-card p-4">
                        <i class="fas fa-cut text-2xl mb-2 text-pink-400"></i>
                        <p class="text-sm font-medium">Precise Splitting</p>
                    </div>
                    <div class="glass-card p-4">
                        <i class="fas fa-bookmark text-2xl mb-2 text-blue-400"></i>
                        <p class="text-sm font-medium">Bookmark Preservation</p>
                    </div>
                    <div class="glass-card p-4">
                        <i class="fas fa-layer-group text-2xl mb-2 text-green-400"></i>
                        <p class="text-sm font-medium">Batch Processing</p>
                    </div>
                </div>
            </div>

            <!-- Operation Tabs -->
            <div class="glass-card p-8 mb-8">
                <div class="flex flex-col md:flex-row gap-4 mb-8">
                    <button class="tab-button active" onclick="switchMode('merge')" id="mergeTab">
                        <i class="fas fa-object-group mr-2"></i>
                        Merge PDFs
                    </button>
                    <button class="tab-button" onclick="switchMode('split')" id="splitTab">
                        <i class="fas fa-cut mr-2"></i>
                        Split PDF
                    </button>
                </div>

                <!-- Merge Mode -->
                <div id="mergeMode" class="operation-mode">
                    <div class="drop-zone" id="mergeDropZone" onclick="document.getElementById('mergeFileInput').click()">
                        <i class="fas fa-cloud-upload-alt text-4xl mb-4 opacity-50"></i>
                        <h3 class="text-xl font-semibold mb-2">Drop PDF files here to merge</h3>
                        <p class="opacity-70 mb-4">or click to browse files</p>
                        <p class="text-sm opacity-50">Supports multiple PDF files</p>
                    </div>
                    <input type="file" id="mergeFileInput" multiple accept=".pdf" style="display: none;">
                    
                    <!-- Merge Options -->
                    <div class="mt-6 p-6 glass-card">
                        <h4 class="text-lg font-semibold mb-4"><i class="fas fa-cog mr-2"></i>Merge Options</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <label class="flex items-center space-x-3">
                                <input type="checkbox" id="preserveBookmarks" checked class="w-4 h-4">
                                <span>Preserve bookmarks</span>
                            </label>
                            <label class="flex items-center space-x-3">
                                <input type="checkbox" id="optimizeSize" class="w-4 h-4">
                                <span>Optimize file size</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- File List -->
                    <div id="mergeFileList" class="mt-6"></div>
                    
                    <button class="btn-gradient btn-success mt-6" id="mergeBtn" onclick="mergePDFs()" disabled>
                        <i class="fas fa-magic mr-2"></i>
                        Merge PDFs
                    </button>
                </div>

                <!-- Split Mode -->
                <div id="splitMode" class="operation-mode" style="display: none;">
                    <div class="drop-zone" id="splitDropZone" onclick="document.getElementById('splitFileInput').click()">
                        <i class="fas fa-file-upload text-4xl mb-4 opacity-50"></i>
                        <h3 class="text-xl font-semibold mb-2">Drop a PDF file here to split</h3>
                        <p class="opacity-70 mb-4">or click to browse file</p>
                        <p class="text-sm opacity-50">Single PDF file only</p>
                    </div>
                    <input type="file" id="splitFileInput" accept=".pdf" style="display: none;">
                    
                    <!-- Split Options -->
                    <div class="mt-6 p-6 glass-card" id="splitOptions" style="display: none;">
                        <h4 class="text-lg font-semibold mb-4"><i class="fas fa-scissors mr-2"></i>Split Options</h4>
                        
                        <div class="space-y-4">
                            <label class="flex items-center space-x-3">
                                <input type="radio" name="splitMode" value="all" checked class="w-4 h-4">
                                <span>Split into individual pages</span>
                            </label>
                            <label class="flex items-center space-x-3">
                                <input type="radio" name="splitMode" value="range" class="w-4 h-4">
                                <span>Split by page range</span>
                            </label>
                            <label class="flex items-center space-x-3">
                                <input type="radio" name="splitMode" value="custom" class="w-4 h-4">
                                <span>Select specific pages</span>
                            </label>
                        </div>
                        
                        <!-- Range Input -->
                        <div id="rangeInput" class="mt-4" style="display: none;">
                            <div class="flex items-center space-x-4">
                                <input type="number" id="startPage" placeholder="Start page" min="1" 
                                       class="px-4 py-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50">
                                <span>to</span>
                                <input type="number" id="endPage" placeholder="End page" min="1"
                                       class="px-4 py-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50">
                            </div>
                        </div>
                        
                        <!-- Page Selection -->
                        <div id="pageSelection" class="mt-4" style="display: none;"></div>
                    </div>
                    
                    <!-- PDF Preview -->
                    <div id="splitPreview" class="mt-6"></div>
                    
                    <button class="btn-gradient btn-warning mt-6" id="splitBtn" onclick="splitPDF()" disabled>
                        <i class="fas fa-cut mr-2"></i>
                        Split PDF
                    </button>
                </div>

                <!-- Progress Bar -->
                <div id="progressContainer" class="mt-6" style="display: none;">
                    <div class="flex justify-between items-center mb-2">
                        <span id="progressText">Processing...</span>
                        <span id="progressPercent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>

                <!-- Results -->
                <div id="results" class="mt-8" style="display: none;"></div>
            </div>

            <!-- Features Section -->
            <div class="glass-card p-8">
                <h2 class="text-2xl font-bold mb-6 text-center">
                    <i class="fas fa-star mr-2 text-yellow-400"></i>
                    Professional Features
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="text-center">
                        <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-r from-purple-400 to-pink-400 flex items-center justify-center">
                            <i class="fas fa-shield-alt text-white text-xl"></i>
                        </div>
                        <h3 class="font-semibold mb-2">100% Secure</h3>
                        <p class="text-sm opacity-70">All processing happens locally in your browser. No files uploaded to servers.</p>
                    </div>
                    
                    <div class="text-center">
                        <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-r from-blue-400 to-cyan-400 flex items-center justify-center">
                            <i class="fas fa-lightning-bolt text-white text-xl"></i>
                        </div>
                        <h3 class="font-semibold mb-2">Lightning Fast</h3>
                        <p class="text-sm opacity-70">Optimized algorithms for quick processing of large PDF files.</p>
                    </div>
                    
                    <div class="text-center">
                        <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-r from-green-400 to-blue-500 flex items-center justify-center">
                            <i class="fas fa-mobile-alt text-white text-xl"></i>
                        </div>
                        <h3 class="font-semibold mb-2">Mobile Friendly</h3>
                        <p class="text-sm opacity-70">Works perfectly on all devices with responsive design.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Theme Management
        function toggleTheme() {
            document.body.classList.toggle('light-theme');
            localStorage.setItem('theme', document.body.classList.contains('light-theme') ? 'light' : 'dark');
        }

        // Initialize theme
        if (localStorage.getItem('theme') === 'light') {
            document.body.classList.add('light-theme');
        }

        // Particles Animation
        function createParticles() {
            const container = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.width = particle.style.height = Math.random() * 10 + 5 + 'px';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = Math.random() * 10 + 15 + 's';
                container.appendChild(particle);
            }
        }
        createParticles();

        // Global Variables
        let mergeFiles = [];
        let splitFile = null;
        let splitPdfDoc = null;
        let totalPages = 0;

        // Mode Switching
        function switchMode(mode) {
            const mergeTab = document.getElementById('mergeTab');
            const splitTab = document.getElementById('splitTab');
            const mergeMode = document.getElementById('mergeMode');
            const splitMode = document.getElementById('splitMode');

            if (mode === 'merge') {
                mergeTab.classList.add('active');
                splitTab.classList.remove('active');
                mergeMode.style.display = 'block';
                splitMode.style.display = 'none';
            } else {
                splitTab.classList.add('active');
                mergeTab.classList.remove('active');
                splitMode.style.display = 'block';
                mergeMode.style.display = 'none';
            }

            hideProgress();
            hideResults();
        }

        // File Input Handlers
        document.getElementById('mergeFileInput').addEventListener('change', handleMergeFiles);
        document.getElementById('splitFileInput').addEventListener('change', handleSplitFile);

        // Drag and Drop Handlers
        function setupDropZone(dropZoneId, inputId, handler) {
            const dropZone = document.getElementById(dropZoneId);
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });

            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => dropZone.classList.add('drag-over'), false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => dropZone.classList.remove('drag-over'), false);
            });

            dropZone.addEventListener('drop', (e) => {
                const files = e.dataTransfer.files;
                document.getElementById(inputId).files = files;
                handler({ target: { files } });
            });
        }

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        setupDropZone('mergeDropZone', 'mergeFileInput', handleMergeFiles);
        setupDropZone('splitDropZone', 'splitFileInput', handleSplitFile);

        // Handle Merge Files
        async function handleMergeFiles(event) {
            const files = Array.from(event.target.files);
            mergeFiles = files.filter(file => file.type === 'application/pdf');
            
            if (mergeFiles.length === 0) {
                showNotification('Please select PDF files only', 'error');
                return;
            }

            displayMergeFiles();
            document.getElementById('mergeBtn').disabled = mergeFiles.length < 2;
        }

        function displayMergeFiles() {
            const container = document.getElementById('mergeFileList');
            container.innerHTML = '';

            mergeFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-file-pdf text-red-400 text-xl"></i>
                        <div>
                            <div class="font-medium">${file.name}</div>
                            <div class="text-sm opacity-70">${formatFileSize(file.size)}</div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button onclick="moveFile(${index}, -1)" class="p-2 hover:bg-white/10 rounded-lg" ${index === 0 ? 'disabled' : ''}>
                            <i class="fas fa-arrow-up"></i>
                        </button>
                        <button onclick="moveFile(${index}, 1)" class="p-2 hover:bg-white/10 rounded-lg" ${index === mergeFiles.length - 1 ? 'disabled' : ''}>
                            <i class="fas fa-arrow-down"></i>
                        </button>
                        <button onclick="removeFile(${index})" class="p-2 hover:bg-white/10 rounded-lg text-red-400">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                container.appendChild(fileItem);
            });
        }

        function moveFile(index, direction) {
            const newIndex = index + direction;
            if (newIndex >= 0 && newIndex < mergeFiles.length) {
                [mergeFiles[index], mergeFiles[newIndex]] = [mergeFiles[newIndex], mergeFiles[index]];
                displayMergeFiles();
            }
        }

        function removeFile(index) {
            mergeFiles.splice(index, 1);
            displayMergeFiles();
            document.getElementById('mergeBtn').disabled = mergeFiles.length < 2;
        }

        // Handle Split File
        async function handleSplitFile(event) {
            const file = event.target.files[0];
            if (!file || file.type !== 'application/pdf') {
                showNotification('Please select a PDF file', 'error');
                return;
            }

            splitFile = file;
            await loadSplitPDF();
        }

        async function loadSplitPDF() {
            try {
                showProgress('Loading PDF...', 10);
                
                const arrayBuffer = await splitFile.arrayBuffer();
                splitPdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
                totalPages = splitPdfDoc.getPageCount();

                showProgress('PDF loaded successfully', 100);
                setTimeout(hideProgress, 1000);

                document.getElementById('splitOptions').style.display = 'block';
                document.getElementById('splitBtn').disabled = false;
                
                setupPageSelection();
                setupSplitModeListeners();
                
                showNotification(`PDF loaded: ${totalPages} pages`, 'success');
            } catch (error) {
                hideProgress();
                showNotification('Error loading PDF: ' + error.message, 'error');
            }
        }

        function setupPageSelection() {
            const container = document.getElementById('pageSelection');
            container.innerHTML = '<h5 class="font-medium mb-3">Select Pages:</h5>';
            
            const selectAll = document.createElement('button');
            selectAll.className = 'btn-gradient mb-3 mr-2';
            selectAll.innerHTML = '<i class="fas fa-check-double mr-2"></i>Select All';
            selectAll.onclick = () => toggleAllPages(true);
            container.appendChild(selectAll);
            
            const selectNone = document.createElement('button');
            selectNone.className = 'btn-gradient mb-3';
            selectNone.innerHTML = '<i class="fas fa-times mr-2"></i>Select None';
            selectNone.onclick = () => toggleAllPages(false);
            container.appendChild(selectNone);
            
            const pageSelector = document.createElement('div');
            pageSelector.className = 'page-selector';
            
            for (let i = 1; i <= totalPages; i++) {
                const pageCheck = document.createElement('label');
                pageCheck.className = 'page-checkbox';
                pageCheck.innerHTML = `
                    <input type="checkbox" value="${i}" class="page-check">
                    <span>Page ${i}</span>
                `;
                pageSelector.appendChild(pageCheck);
            }
            
            container.appendChild(pageSelector);
        }

        function toggleAllPages(select) {
            const checkboxes = document.querySelectorAll('.page-check');
            checkboxes.forEach(cb => cb.checked = select);
        }

        function setupSplitModeListeners() {
            const radios = document.querySelectorAll('input[name="splitMode"]');
            const rangeInput = document.getElementById('rangeInput');
            const pageSelection = document.getElementById('pageSelection');
            
            radios.forEach(radio => {
                radio.addEventListener('change', () => {
                    rangeInput.style.display = radio.value === 'range' ? 'block' : 'none';
                    pageSelection.style.display = radio.value === 'custom' ? 'block' : 'none';
                });
            });

            // Set max values for range inputs
            document.getElementById('startPage').max = totalPages;
            document.getElementById('endPage').max = totalPages;
        }

        // Merge PDFs
        async function mergePDFs() {
            if (mergeFiles.length < 2) {
                showNotification('Select at least 2 PDF files to merge', 'error');
                return;
            }

            try {
                showProgress('Initializing merge...', 0);
                
                const mergedPdf = await PDFLib.PDFDocument.create();
                const preserveBookmarks = document.getElementById('preserveBookmarks').checked;
                
                for (let i = 0; i < mergeFiles.length; i++) {
                    const progress = ((i + 1) / mergeFiles.length) * 90;
                    showProgress(`Processing file ${i + 1}/${mergeFiles.length}...`, progress);
                    
                    const arrayBuffer = await mergeFiles[i].arrayBuffer();
                    const pdf = await PDFLib.PDFDocument.load(arrayBuffer);
                    const pages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
                    
                    pages.forEach(page => mergedPdf.addPage(page));
                    
                    if (preserveBookmarks) {
                        // Copy bookmarks (simplified implementation)
                        const bookmarks = pdf.getForm().getFields();
                        // Implementation would copy bookmarks here
                    }
                }

                showProgress('Generating merged PDF...', 95);
                
                const pdfBytes = await mergedPdf.save();
                const optimizeSize = document.getElementById('optimizeSize').checked;
                
                showProgress('Download ready!', 100);
                
                downloadFile(pdfBytes, 'merged-document.pdf');
                showResults([{ name: 'merged-document.pdf', size: pdfBytes.length }]);
                
                showNotification('PDFs merged successfully!', 'success');
                
            } catch (error) {
                hideProgress();
                showNotification('Error merging PDFs: ' + error.message, 'error');
            }
        }

        // Split PDF
        async function splitPDF() {
            if (!splitFile) {
                showNotification('Please select a PDF file to split', 'error');
                return;
            }

            try {
                const splitMode = document.querySelector('input[name="splitMode"]:checked').value;
                let pagesToSplit = [];
                
                if (splitMode === 'all') {
                    pagesToSplit = Array.from({ length: totalPages }, (_, i) => i + 1);
                } else if (splitMode === 'range') {
                    const start = parseInt(document.getElementById('startPage').value);
                    const end = parseInt(document.getElementById('endPage').value);
                    
                    if (!start || !end || start > end || start < 1 || end > totalPages) {
                        showNotification('Please enter a valid page range', 'error');
                        return;
                    }
                    
                    pagesToSplit = Array.from({ length: end - start + 1 }, (_, i) => start + i);
                } else if (splitMode === 'custom') {
                    const selected = Array.from(document.querySelectorAll('.page-check:checked'));
                    pagesToSplit = selected.map(cb => parseInt(cb.value));
                    
                    if (pagesToSplit.length === 0) {
                        showNotification('Please select at least one page', 'error');
                        return;
                    }
                }

                showProgress('Splitting PDF...', 0);
                const results = [];
                
                for (let i = 0; i < pagesToSplit.length; i++) {
                    const progress = ((i + 1) / pagesToSplit.length) * 90;
                    showProgress(`Creating page ${i + 1}/${pagesToSplit.length}...`, progress);
                    
                    const newPdf = await PDFLib.PDFDocument.create();
                    const [copiedPage] = await newPdf.copyPages(splitPdfDoc, [pagesToSplit[i] - 1]);
                    newPdf.addPage(copiedPage);
                    
                    const pdfBytes = await newPdf.save();
                    const fileName = `page-${pagesToSplit[i]}.pdf`;
                    
                    downloadFile(pdfBytes, fileName);
                    results.push({ name: fileName, size: pdfBytes.length });
                }

                showProgress('Split complete!', 100);
                showResults(results);
                showNotification(`PDF split into ${pagesToSplit.length} files`, 'success');
                
            } catch (error) {
                hideProgress();
                showNotification('Error splitting PDF: ' + error.message, 'error');
            }
        }

        // Utility Functions
        function downloadFile(data, filename) {
            const blob = new Blob([data], { type: 'application/pdf' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function showProgress(text, percent) {
            document.getElementById('progressContainer').style.display = 'block';
            document.getElementById('progressText').textContent = text;
            document.getElementById('progressPercent').textContent = Math.round(percent) + '%';
            document.getElementById('progressFill').style.width = percent + '%';
        }

        function hideProgress() {
            document.getElementById('progressContainer').style.display = 'none';
        }

        function showResults(files) {
            const container = document.getElementById('results');
            container.innerHTML = `
                <h3 class="text-xl font-semibold mb-4">
                    <i class="fas fa-check-circle text-green-400 mr-2"></i>
                    Operation Complete
                </h3>
                <div class="space-y-2">
                    ${files.map(file => `
                        <div class="file-item">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-file-pdf text-red-400 text-xl"></i>
                                <div>
                                    <div class="font-medium">${file.name}</div>
                                    <div class="text-sm opacity-70">${formatFileSize(file.size)}</div>
                                </div>
                            </div>
                            <i class="fas fa-download text-green-400"></i>
                        </div>
                    `).join('')}
                </div>
                <p class="text-sm opacity-70 mt-4">Files have been automatically downloaded to your device.</p>
            `;
            container.style.display = 'block';
        }

        function hideResults() {
            document.getElementById('results').style.display = 'none';
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} mr-2"></i>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }
    </script>
<script src="/homebutton.js"></script>
</body>

</html>
