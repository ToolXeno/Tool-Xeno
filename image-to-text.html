<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Image to Text OCR Tool - Tool Xeno</title>
    <meta name="description" content="Professional OCR tool with advanced image processing, multi-format support, text extraction, editing capabilities, and premium features.">

    <!-- ‚úÖ Tool Xeno Favicons -->
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    
    <!-- External Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tesseract.js for Client-Side OCR -->
    <script src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js'></script>

    <!-- Favicon Override -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='g' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' stop-color='%23667eea'/><stop offset='100%' stop-color='%23764ba2'/></linearGradient></defs><rect width='100' height='100' rx='15' fill='url(%23g)'/><path fill='white' d='M30,42 L42,42 L42,30 L58,30 L58,42 L70,42 L70,58 L58,58 L58,70 L42,70 L42,58 L30,58 Z' transform='rotate(45 50 50)'/></svg>">
    
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --accent-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --success-gradient: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            
            --dark-bg: #0a0a0a;
            --dark-surface: #1a1a1a;
            --dark-surface-elevated: #252525;
            --dark-text: #ffffff;
            --dark-text-secondary: #a0a0a0;
            --dark-border: #333333;
            
            --light-bg: #f8fafc;
            --light-surface: #ffffff;
            --light-surface-elevated: #f1f5f9;
            --light-text: #1e293b;
            --light-text-secondary: #64748b;
            --light-border: #e2e8f0;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            transition: background-color 0.35s cubic-bezier(0.4, 0, 0.2, 1), color 0.35s cubic-bezier(0.4, 0, 0.2, 1);
            line-height: 1.6;
            background-color: var(--dark-bg);
            color: var(--dark-text);
            min-height: 100vh;
        }
        
        body.light-theme { background-color: var(--light-bg); color: var(--light-text); }

        .particles-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }
        
        .particle {
            position: absolute;
            border-radius: 50%;
            animation: float 20s infinite linear;
            opacity: 0.05;
            background: radial-gradient(circle, #667eea 0%, transparent 70%);
        }
        
        body.light-theme .particle { background: radial-gradient(circle, #4facfe 0%, transparent 70%); }
        @keyframes float { 0% { transform: translateY(100vh) rotate(0deg); } 100% { transform: translateY(-100px) rotate(360deg); } }
        
        .header-glass {
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            background: rgba(0, 0, 0, 0.4);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: background-color 0.35s ease, border-color 0.35s ease;
        }
        
        body.light-theme .header-glass { background: rgba(255, 255, 255, 0.9); border-bottom-color: rgba(0, 0, 0, 0.1); }
        
        .theme-toggle {
            position: relative;
            width: 60px;
            height: 30px;
            background: var(--dark-surface);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .theme-toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 22px;
            height: 22px;
            background: var(--primary-gradient);
            border-radius: 50%;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        body.light-theme .theme-toggle { background: var(--light-surface-elevated); border-color: var(--light-border); }
        body.light-theme .theme-toggle::after { transform: translateX(28px); background: var(--secondary-gradient); }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1), background-color 0.35s ease, border-color 0.35s ease;
            position: relative;
            overflow: hidden;
        }
        
        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        }
        
        body.light-theme .glass-card { background-color: rgba(255, 255, 255, 0.9); border-color: rgba(0, 0, 0, 0.1); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); }
        
        .btn-gradient {
            background: var(--primary-gradient);
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-gradient::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-gradient:hover::before { left: 100%; }
        .btn-gradient:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4); }
        .btn-gradient:active { transform: translateY(0); }
        .btn-gradient:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 12px 24px;
            color: inherit;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-secondary:hover { background: rgba(255, 255, 255, 0.2); transform: translateY(-1px); }
        body.light-theme .btn-secondary { background: rgba(0, 0, 0, 0.1); border-color: rgba(0, 0, 0, 0.2); }
        body.light-theme .btn-secondary:hover { background: rgba(0, 0, 0, 0.2); }
        
        .upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 16px;
            padding: 40px 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .upload-area:hover, .upload-area.dragover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            transform: scale(1.02);
        }
        
        body.light-theme .upload-area { border-color: rgba(0, 0, 0, 0.3); }
        body.light-theme .upload-area:hover, body.light-theme .upload-area.dragover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--primary-gradient);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }
        
        body.light-theme .progress-bar { background: rgba(0, 0, 0, 0.1); }
        
        .image-preview {
            max-width: 100%;
            max-height: 400px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
        .text-output {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            min-height: 200px;
            resize: vertical;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            line-height: 1.5;
            color: inherit;
            width: 100%;
        }
        
        body.light-theme .text-output { background: white; border-color: var(--light-border); }
        
        .feature-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .feature-card:hover { transform: translateY(-4px); background: rgba(255, 255, 255, 0.1); }
        body.light-theme .feature-card { background: white; border-color: var(--light-border); }
        
        .processing-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        
        .processing-content {
            background: var(--dark-surface);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        body.light-theme .processing-content { background: var(--light-surface); border-color: var(--light-border); }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-left: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .confidence-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 8px;
        }
        
        .confidence-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        .confidence-high { background: var(--success-gradient); }
        .confidence-medium { background: var(--accent-gradient); }
        .confidence-low { background: var(--secondary-gradient); }
        
        .settings-panel {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        body.light-theme .settings-panel { background: white; border-color: var(--light-border); }
        
        .setting-group {
            margin-bottom: 16px;
        }
        
        .setting-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: inherit;
        }
        
        .setting-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: inherit;
            font-size: 14px;
        }
        
        body.light-theme .setting-input { background: white; border-color: var(--light-border); }
        
        .fade-in { animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards; opacity: 0; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        @media (max-width: 768px) {
            .container { padding: 0 16px; }
            .grid { grid-template-columns: 1fr; }
            .lg\\:grid-cols-2 { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- Types & Enums ---
        const OcrLanguage = {
            ENG: 'eng',
            SPA: 'spa',
            FRA: 'fra',
            DEU: 'deu',
            ITA: 'ita',
            POR: 'por',
            RUS: 'rus',
            CHI_SIM: 'chi_sim',
            JPN: 'jpn',
            ARA: 'ara'
        };

        // --- Components ---

        // ParticleBackground.tsx
        const ParticleBackground = ({ isLight }) => {
            const [particles, setParticles] = React.useState([]);

            React.useEffect(() => {
                const particleCount = window.innerWidth < 768 ? 20 : 50;
                const newParticles = [];
                for (let i = 0; i < particleCount; i++) {
                    newParticles.push({
                        id: i,
                        style: {
                            left: Math.random() * 100 + '%',
                            width: Math.random() * 4 + 2 + 'px',
                            height: Math.random() * 4 + 2 + 'px',
                            animationDuration: Math.random() * 10 + 10 + 's',
                            animationDelay: Math.random() * 10 + 's'
                        }
                    });
                }
                setParticles(newParticles);
            }, []);

            return (
                <div className="particles-container" id="particles">
                    {particles.map((p) => (
                        <div
                            key={p.id}
                            className="particle"
                            style={p.style}
                        />
                    ))}
                </div>
            );
        };

        // Header.tsx
        const Header = ({ isLight, toggleTheme }) => {
            return (
                <header className="header-glass fixed w-full top-0 z-50">
                    <div className="container mx-auto px-6 py-4">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center space-x-4">
                                <div className="text-3xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
                                    üõ†Ô∏è Tool Xeno
                                </div>
                                <div className="hidden md:block text-sm opacity-70">
                                    Advanced OCR Tool
                                </div>
                            </div>
                            <div className="flex items-center space-x-4">
                                <button 
                                    className="theme-toggle" 
                                    id="themeToggle" 
                                    onClick={toggleTheme} 
                                    aria-label="Toggle light and dark theme"
                                ></button>
                            </div>
                        </div>
                    </div>
                </header>
            );
        };

        // ProcessingOverlay.tsx
        const ProcessingOverlay = ({ visible, status, progress }) => {
            return (
                <div className="processing-overlay" id="processingOverlay" style={{ display: visible ? 'flex' : 'none' }}>
                    <div className="processing-content">
                        <div className="spinner"></div>
                        <h3 className="text-xl font-semibold mb-2">Processing Image</h3>
                        <p className="text-sm opacity-70" id="processingStatus">{status}</p>
                        <div className="progress-bar mt-4">
                            <div className="progress-fill" id="processingProgress" style={{ width: `${progress}%` }}></div>
                        </div>
                    </div>
                </div>
            );
        };

        // Features.tsx
        const Features = () => {
            return (
                <section className="container mx-auto px-6 mb-16">
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div className="feature-card fade-in" style={{ animationDelay: '0s' }}>
                            <div className="text-3xl mb-4"><i className="fas fa-brain text-purple-400"></i></div>
                            <h3 className="text-lg font-semibold mb-2">AI-Powered OCR</h3>
                            <p className="text-sm opacity-70">Advanced neural networks for superior text recognition accuracy</p>
                        </div>
                        <div className="feature-card fade-in" style={{ animationDelay: '0.1s' }}>
                            <div className="text-3xl mb-4"><i className="fas fa-language text-blue-400"></i></div>
                            <h3 className="text-lg font-semibold mb-2">Multi-Language</h3>
                            <p className="text-sm opacity-70">Support for 100+ languages with automatic language detection</p>
                        </div>
                        <div className="feature-card fade-in" style={{ animationDelay: '0.2s' }}>
                            <div className="text-3xl mb-4"><i className="fas fa-magic text-pink-400"></i></div>
                            <h3 className="text-lg font-semibold mb-2">Image Enhancement</h3>
                            <p className="text-sm opacity-70">Automatic image preprocessing for optimal OCR results</p>
                        </div>
                        <div className="feature-card fade-in" style={{ animationDelay: '0.3s' }}>
                            <div className="text-3xl mb-4"><i className="fas fa-file-export text-green-400"></i></div>
                            <h3 className="text-lg font-semibold mb-2">Export Options</h3>
                            <p className="text-sm opacity-70">Export to multiple formats: TXT, DOCX, PDF with formatting</p>
                        </div>
                    </div>
                </section>
            );
        };

        // Tips.tsx
        const Tips = () => {
            return (
                <div className="glass-card p-8 mb-8">
                    <h3 className="text-2xl font-semibold mb-6 flex items-center gap-2">
                        <i className="fas fa-lightbulb text-yellow-400"></i>
                        Tips for Better OCR Results
                    </h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div className="flex items-start gap-3">
                            <div className="text-xl text-green-400 mt-1"><i className="fas fa-check-circle"></i></div>
                            <div>
                                <h4 className="font-semibold mb-1">High Resolution</h4>
                                <p className="text-sm opacity-70">Use images with at least 300 DPI for optimal text recognition</p>
                            </div>
                        </div>
                        <div className="flex items-start gap-3">
                            <div className="text-xl text-green-400 mt-1"><i className="fas fa-check-circle"></i></div>
                            <div>
                                <h4 className="font-semibold mb-1">Good Contrast</h4>
                                <p className="text-sm opacity-70">Ensure clear contrast between text and background colors</p>
                            </div>
                        </div>
                        <div className="flex items-start gap-3">
                            <div className="text-xl text-green-400 mt-1"><i className="fas fa-check-circle"></i></div>
                            <div>
                                <h4 className="font-semibold mb-1">Straight Alignment</h4>
                                <p className="text-sm opacity-70">Keep text horizontally aligned to improve recognition accuracy</p>
                            </div>
                        </div>
                        <div className="flex items-start gap-3">
                            <div className="text-xl text-green-400 mt-1"><i className="fas fa-check-circle"></i></div>
                            <div>
                                <h4 className="font-semibold mb-1">Clear Text</h4>
                                <p className="text-sm opacity-70">Avoid blurry, distorted, or heavily stylized fonts</p>
                            </div>
                        </div>
                        <div className="flex items-start gap-3">
                            <div className="text-xl text-green-400 mt-1"><i className="fas fa-check-circle"></i></div>
                            <div>
                                <h4 className="font-semibold mb-1">Proper Lighting</h4>
                                <p className="text-sm opacity-70">Even lighting without shadows or reflections works best</p>
                            </div>
                        </div>
                        <div className="flex items-start gap-3">
                            <div className="text-xl text-green-400 mt-1"><i className="fas fa-check-circle"></i></div>
                            <div>
                                <h4 className="font-semibold mb-1">Supported Formats</h4>
                                <p className="text-sm opacity-70">JPG, PNG, BMP, GIF, TIFF, and WebP formats supported</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // OCRTool.tsx (Consolidated Logic)
        const OCRTool = ({ setProcessing }) => {
            const [imagePreview, setImagePreview] = React.useState(null);
            const [currentFile, setCurrentFile] = React.useState(null);
            const [extractedText, setExtractedText] = React.useState('');
            const [confidence, setConfidence] = React.useState(0);
            const [showConfidence, setShowConfidence] = React.useState(false);
            
            // Settings State
            const [settings, setSettings] = React.useState({
                language: OcrLanguage.ENG,
                ocrMode: "1", // Mapped to LSTM in Tesseract default
                pageSegMode: "3", // Auto
                enhanceImage: true,
                preserveFormatting: true
            });

            const fileInputRef = React.useRef(null);
            const textOutputRef = React.useRef(null);

            // Stats
            const charCount = extractedText.length;
            const wordCount = extractedText.trim() === '' ? 0 : extractedText.trim().split(/\s+/).length;
            const lineCount = extractedText === '' ? 0 : extractedText.split('\n').length;

            const handleFileSelect = (file) => {
                const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/bmp', 'image/gif', 'image/tiff', 'image/webp'];
                if (!validTypes.includes(file.type)) {
                    alert('Please select a valid image file (JPG, PNG, BMP, GIF, TIFF, WebP)');
                    return;
                }
                // Tesseract.js handles larger files well, but let's keep a reasonable limit for browser performance
                if (file.size > 20 * 1024 * 1024) { 
                    alert('File size must be less than 20MB');
                    return;
                }

                setCurrentFile(file);
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    setImagePreview(e.target?.result);
                };
                reader.readAsDataURL(file);
            };

            const handleInputChange = (e) => {
                if (e.target.files && e.target.files[0]) {
                    handleFileSelect(e.target.files[0]);
                }
            };

            const handleDrop = (e) => {
                e.preventDefault();
                e.currentTarget.classList.remove('dragover');
                if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                    handleFileSelect(e.dataTransfer.files[0]);
                }
            };

            const clearImage = () => {
                setCurrentFile(null);
                setImagePreview(null);
                if (fileInputRef.current) fileInputRef.current.value = '';
                clearText();
            };

            const clearText = () => {
                setExtractedText('');
                setShowConfidence(false);
            };

            const preprocessImage = (file) => {
                return new Promise((resolve) => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const img = new Image();
                    
                    img.onload = () => {
                        if (!ctx) return resolve(file);
                        
                        canvas.width = img.width;
                        canvas.height = img.height;
                        
                        // Draw original image
                        ctx.drawImage(img, 0, 0);
                        
                        // Get image data for processing
                        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                        const data = imageData.data;
                        
                        // Apply image enhancement algorithms
                        for (let i = 0; i < data.length; i += 4) {
                            // Convert to grayscale and increase contrast
                            const gray = data[i] * 0.299 + data[i + 1] * 0.587 + data[i + 2] * 0.114;
                            const enhanced = gray > 128 ? 255 : 0; // Thresholding
                            
                            data[i] = enhanced;     // Red
                            data[i + 1] = enhanced; // Green
                            data[i + 2] = enhanced; // Blue
                            // Alpha stays the same
                        }
                        
                        // Put processed data back
                        ctx.putImageData(imageData, 0, 0);
                        
                        // Convert canvas to blob
                        canvas.toBlob((blob) => resolve(blob || file), 'image/png');
                    };
                    
                    img.src = URL.createObjectURL(file);
                });
            };

            const processImage = async () => {
                if (!currentFile) {
                    alert('Please select an image first');
                    return;
                }
                
                setProcessing(true, 'Initializing OCR engine...', 0);
                
                try {
                    let imageToProcess = currentFile;
                    // Preprocess image if enhancement is enabled
                    if (settings.enhanceImage) {
                        setProcessing(true, 'Enhancing image quality...', 10);
                        imageToProcess = await preprocessImage(currentFile);
                    }
                    
                    setProcessing(true, 'Loading language model...', 20);
                    
                    const lang = settings.language;
                    
                    // Initialize Tesseract Worker
                    const worker = await Tesseract.createWorker(lang, 1, {
                        logger: m => {
                            if (m.status === 'recognizing text') {
                                setProcessing(true, 'Recognizing text...', 30 + (m.progress * 70));
                            } else if (m.status === 'loading language traineddata') {
                                setProcessing(true, `Loading ${lang} model...`, 20 + (m.progress * 10));
                            } else {
                                // Other statuses like initializing api
                                if (m.progress === 1) return;
                                // setProcessing(true, m.status, 0); 
                            }
                        }
                    });

                    // Set Parameters
                    // Mapping pageSegMode: "6" -> Single Block, "3" -> Auto (Default)
                    const psm = settings.pageSegMode === "6" ? "6" : "3";
                    
                    await worker.setParameters({
                        tessedit_pageseg_mode: psm,
                    });
                    
                    const { data: { text, confidence } } = await worker.recognize(imageToProcess);
                    
                    setExtractedText(text.trim());
                    setConfidence(Math.round(confidence));
                    setShowConfidence(true);
                    
                    await worker.terminate();
                    
                    if (!text.trim()) {
                        alert('No text detected. Try improving image quality or contrast.');
                    }
                    
                    setProcessing(false, 'Done', 100);
                    
                } catch (error) {
                    console.error('OCR Error:', error);
                    setProcessing(false, '', 0);
                    alert('Error processing image: ' + (error.message || 'Unknown error'));
                }
            };

            const copyText = () => {
                if (!extractedText) return;
                navigator.clipboard.writeText(extractedText);
                
                const btn = document.getElementById('copyBtn');
                if (btn) {
                    const originalHTML = btn.innerHTML;
                    const originalBg = btn.style.background;
                    
                    btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                    btn.style.background = 'var(--success-gradient)';
                    
                    setTimeout(() => {
                        btn.innerHTML = originalHTML;
                        btn.style.background = originalBg;
                    }, 2000);
                }
            };

            const downloadText = () => {
                if (!extractedText.trim()) return;
                
                const blob = new Blob([extractedText], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'extracted-text-' + new Date().toISOString().slice(0, 10) + '.txt';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            const exportAsWord = () => {
                if (!extractedText.trim()) return;
                
                const htmlContent = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <title>OCR Extracted Text</title>
                    </head>
                    <body>
                        <h1>OCR Extracted Text</h1>
                        <p>Extracted on: ${new Date().toLocaleDateString()}</p>
                        <hr>
                        <pre>${extractedText}</pre>
                    </body>
                    </html>
                `;
                
                const blob = new Blob([htmlContent], { type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'extracted-text-' + new Date().toISOString().slice(0, 10) + '.doc';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            const exportAsPDF = () => {
                if (!extractedText.trim()) return;
                
                const printWindow = window.open('', '_blank');
                if (!printWindow) return;

                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>OCR Extracted Text</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
                            h1 { color: #333; border-bottom: 2px solid #667eea; }
                            .metadata { color: #666; font-size: 14px; margin-bottom: 20px; }
                            .content { white-space: pre-wrap; font-family: 'Courier New', monospace; }
                        </style>
                    </head>
                    <body>
                        <h1>OCR Extracted Text</h1>
                        <div class="metadata">
                            <p>Extracted on: ${new Date().toLocaleDateString()}</p>
                            <p>Characters: ${extractedText.length}</p>
                            <p>Words: ${extractedText.trim().split(/\s+/).length}</p>
                        </div>
                        <div class="content">${extractedText}</div>
                    </body>
                    </html>
                `);
                printWindow.document.close();
                
                setTimeout(() => {
                    printWindow.print();
                }, 250);
            };

            return (
                <section className="container mx-auto px-6">
                    <div className="glass-card p-8 mb-8">
                        {/* Settings Panel */}
                        <div className="settings-panel">
                            <h3 className="text-xl font-semibold mb-4 flex items-center gap-2">
                                <i className="fas fa-cog text-purple-400"></i>
                                OCR Settings
                            </h3>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div className="setting-group">
                                    <label className="setting-label">Language</label>
                                    <select 
                                        className="setting-input" 
                                        id="ocrLanguage"
                                        value={settings.language}
                                        onChange={(e) => setSettings({...settings, language: e.target.value})}
                                    >
                                        <option value="eng">English</option>
                                        <option value="spa">Spanish</option>
                                        <option value="fra">French</option>
                                        <option value="deu">German</option>
                                        <option value="ita">Italian</option>
                                        <option value="por">Portuguese</option>
                                        <option value="rus">Russian</option>
                                        <option value="chi_sim">Chinese (Simplified)</option>
                                        <option value="jpn">Japanese</option>
                                        <option value="ara">Arabic</option>
                                    </select>
                                </div>
                                <div className="setting-group">
                                    <label className="setting-label">OCR Mode</label>
                                    <select 
                                        className="setting-input" 
                                        id="ocrMode"
                                        value={settings.ocrMode}
                                        onChange={(e) => setSettings({...settings, ocrMode: e.target.value})}
                                        disabled
                                    >
                                        <option value="1">Standard LSTM (Default)</option>
                                        <option value="0">Legacy (Not Supported in Web)</option>
                                    </select>
                                </div>
                                <div className="setting-group">
                                    <label className="setting-label">Page Segmentation</label>
                                    <select 
                                        className="setting-input" 
                                        id="pageSegMode"
                                        value={settings.pageSegMode}
                                        onChange={(e) => setSettings({...settings, pageSegMode: e.target.value})}
                                    >
                                        <option value="3">Auto Segmentation (Default)</option>
                                        <option value="6">Uniform Block</option>
                                    </select>
                                </div>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                                <div className="setting-group">
                                    <label className="setting-label flex items-center gap-2">
                                        <input 
                                            type="checkbox" 
                                            id="enhanceImage" 
                                            className="rounded"
                                            checked={settings.enhanceImage}
                                            onChange={(e) => setSettings({...settings, enhanceImage: e.target.checked})}
                                        />
                                        Enable Image Enhancement
                                    </label>
                                </div>
                                <div className="setting-group">
                                    <label className="setting-label flex items-center gap-2">
                                        <input 
                                            type="checkbox" 
                                            id="preserveFormatting" 
                                            className="rounded"
                                            checked={settings.preserveFormatting}
                                            onChange={(e) => setSettings({...settings, preserveFormatting: e.target.checked})}
                                            disabled
                                        />
                                        Preserve Text Formatting
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        {/* Upload Area */}
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div>
                                <h3 className="text-xl font-semibold mb-4 flex items-center gap-2">
                                    <i className="fas fa-upload text-blue-400"></i>
                                    Upload Image
                                </h3>
                                <div 
                                    className={`upload-area ${!imagePreview ? '' : ''}`} 
                                    id="uploadArea"
                                    onDragOver={(e) => { e.preventDefault(); e.currentTarget.classList.add('dragover'); }}
                                    onDragLeave={(e) => e.currentTarget.classList.remove('dragover')}
                                    onDrop={handleDrop}
                                    onClick={() => fileInputRef.current?.click()}
                                >
                                    <div className="text-4xl mb-4 opacity-50">
                                        <i className="fas fa-cloud-upload-alt"></i>
                                    </div>
                                    <h4 className="text-lg font-semibold mb-2">Drop image here or click to browse</h4>
                                    <p className="text-sm opacity-70 mb-4">Supports: JPG, PNG, BMP, GIF, TIFF, WebP (Max: 20MB)</p>
                                    <button className="btn-gradient" type="button">
                                        <i className="fas fa-folder-open"></i>
                                        Browse Files
                                    </button>
                                    <input 
                                        type="file" 
                                        id="fileInput" 
                                        accept="image/*" 
                                        style={{ display: 'none' }}
                                        ref={fileInputRef}
                                        onChange={handleInputChange}
                                    />
                                </div>
                                
                                {/* Image Preview */}
                                <div id="imagePreviewContainer" className="mt-6" style={{ display: imagePreview ? 'block' : 'none' }}>
                                    <h4 className="text-lg font-semibold mb-4">Image Preview</h4>
                                    <div className="text-center">
                                        <img id="imagePreview" className="image-preview mx-auto" alt="Preview" src={imagePreview || ''} />
                                    </div>
                                    <div className="mt-4 grid grid-cols-2 gap-4">
                                        <button className="btn-secondary" onClick={processImage}>
                                            <i className="fas fa-eye"></i>
                                            Extract Text
                                        </button>
                                        <button className="btn-secondary" onClick={clearImage}>
                                            <i className="fas fa-times"></i>
                                            Clear
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h3 className="text-xl font-semibold mb-4 flex items-center gap-2">
                                    <i className="fas fa-text-width text-green-400"></i>
                                    Extracted Text
                                    <span id="confidenceScore" className="text-sm opacity-70">
                                        {showConfidence ? `(${confidence}% confidence)` : ''}
                                    </span>
                                </h3>
                                
                                {/* Confidence Bar */}
                                <div id="confidenceContainer" className="mb-4" style={{ display: showConfidence ? 'block' : 'none' }}>
                                    <div className="flex justify-between items-center mb-2">
                                        <span className="text-sm font-medium">Confidence Score</span>
                                        <span id="confidencePercent" className="text-sm font-mono">{confidence}%</span>
                                    </div>
                                    <div className="confidence-bar">
                                        <div 
                                            id="confidenceFill" 
                                            className={`confidence-fill ${confidence >= 80 ? 'confidence-high' : confidence >= 60 ? 'confidence-medium' : 'confidence-low'}`} 
                                            style={{ width: `${confidence}%` }}
                                        ></div>
                                    </div>
                                </div>
                                
                                <textarea 
                                    id="extractedText" 
                                    className="text-output" 
                                    placeholder="Extracted text will appear here..."
                                    rows={12}
                                    value={extractedText}
                                    onChange={(e) => setExtractedText(e.target.value)}
                                    ref={textOutputRef}
                                ></textarea>
                                
                                {/* Text Actions */}
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-3 mt-4">
                                    <button className="btn-secondary" onClick={copyText} id="copyBtn" disabled={!extractedText}>
                                        <i className="fas fa-copy"></i>
                                        Copy Text
                                    </button>
                                    <button className="btn-secondary" onClick={downloadText} id="downloadBtn" disabled={!extractedText}>
                                        <i className="fas fa-download"></i>
                                        Download TXT
                                    </button>
                                    <button className="btn-secondary" onClick={clearText} id="clearBtn" disabled={!extractedText}>
                                        <i className="fas fa-eraser"></i>
                                        Clear Text
                                    </button>
                                </div>
                                
                                {/* Advanced Export Options */}
                                <div className="mt-6 p-4 rounded-lg" style={{ background: 'rgba(255, 255, 255, 0.05)', border: '1px solid rgba(255, 255, 255, 0.1)' }}>
                                    <h4 className="text-sm font-semibold mb-3 flex items-center gap-2">
                                        <i className="fas fa-file-export text-purple-400"></i>
                                        Export Options
                                    </h4>
                                    <div className="grid grid-cols-2 gap-3">
                                        <button className="btn-secondary text-sm py-2" onClick={exportAsWord} id="exportWordBtn" disabled={!extractedText}>
                                            <i className="fas fa-file-word"></i>
                                            Export as DOCX
                                        </button>
                                        <button className="btn-secondary text-sm py-2" onClick={exportAsPDF} id="exportPdfBtn" disabled={!extractedText}>
                                            <i className="fas fa-file-pdf"></i>
                                            Export as PDF
                                        </button>
                                    </div>
                                </div>
                                
                                {/* Statistics */}
                                <div id="textStats" className="mt-4 grid grid-cols-3 gap-4 text-center" style={{ display: extractedText ? 'grid' : 'none' }}>
                                    <div>
                                        <div className="text-lg font-bold" id="charCount">{charCount.toLocaleString()}</div>
                                        <div className="text-xs opacity-70">Characters</div>
                                    </div>
                                    <div>
                                        <div className="text-lg font-bold" id="wordCount">{wordCount.toLocaleString()}</div>
                                        <div className="text-xs opacity-70">Words</div>
                                    </div>
                                    <div>
                                        <div className="text-lg font-bold" id="lineCount">{lineCount.toLocaleString()}</div>
                                        <div className="text-xs opacity-70">Lines</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            );
        };

        // App.tsx
        const App = () => {
            const [isLight, setIsLight] = React.useState(false);
            const [processing, setProcessing] = React.useState({
                visible: false,
                status: '',
                progress: 0
            });

            React.useEffect(() => {
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme === 'light' || (!savedTheme && window.matchMedia('(prefers-color-scheme: light)').matches)) {
                    setIsLight(true);
                    document.body.classList.add('light-theme');
                } else {
                    document.body.classList.remove('light-theme');
                }
            }, []);

            const toggleTheme = () => {
                const newLight = !isLight;
                setIsLight(newLight);
                localStorage.setItem('theme', newLight ? 'light' : 'dark');
                if (newLight) {
                    document.body.classList.add('light-theme');
                } else {
                    document.body.classList.remove('light-theme');
                }
            };

            const updateProcessing = (visible, status, progress) => {
                setProcessing({ visible, status, progress });
            };

            return (
                <React.Fragment>
                    <ParticleBackground isLight={isLight} />
                    
                    <ProcessingOverlay 
                        visible={processing.visible} 
                        status={processing.status} 
                        progress={processing.progress} 
                    />

                    <Header isLight={isLight} toggleTheme={toggleTheme} />

                    <main className="pt-20 pb-20">
                        {/* Hero Section */}
                        <section className="container mx-auto px-6 py-16 text-center">
                            <h1 className="text-4xl md:text-6xl font-bold mb-6 bg-gradient-to-r from-purple-400 via-pink-400 to-blue-400 bg-clip-text text-transparent">
                                Advanced Image to Text OCR
                            </h1>
                            <p className="text-lg md:text-xl mb-8 opacity-80 max-w-3xl mx-auto">
                                Extract text from images with professional-grade accuracy using advanced OCR technology. Support for multiple languages, formats, and preprocessing options.
                            </p>
                        </section>

                        <Features />
                        
                        <OCRTool setProcessing={updateProcessing} />
                        
                        <section className="container mx-auto px-6">
                            <Tips />
                        </section>
                    </main>
                </React.Fragment>
            );
        };

        // Main Entry Point
        const rootElement = document.getElementById('root');
        const root = ReactDOM.createRoot(rootElement);
        root.render(
            <React.StrictMode>
                <App />
            </React.StrictMode>
        );
    </script>
</body>
</html>
